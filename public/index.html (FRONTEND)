<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TrendMaster AI - Profesyonel Trading Sistemi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-dark: #05070D;
      --bg-card: #101522;
      --bg-hover: #1A2235;
      --accent-blue: #00BFFF;
      --accent-green: #00FFAA;
      --accent-red: #FF4D4D;
      --accent-orange: #FFA500;
      --text-primary: #FFFFFF;
      --text-secondary: #B0C4DE;
      --text-muted: #708090;
      --border-light: rgba(173,216,230,.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg-dark); color: var(--text-primary); font-family: 'Segoe UI', sans-serif; line-height: 1.6; }

    /* Auth Modal */
    .auth-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .auth-content {
      background: var(--bg-card);
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      border: 1px solid var(--border-light);
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--border-light);
    }

    .auth-tab {
      flex: 1;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .auth-tab.active {
      border-bottom-color: var(--accent-blue);
      color: var(--accent-blue);
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      background: var(--bg-hover);
      border: 1px solid var(--border-light);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .subscription-plans {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .plan-card {
      background: var(--bg-hover);
      padding: 1.5rem 1rem;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s;
    }

    .plan-card:hover {
      border-color: var(--accent-blue);
    }

    .plan-card.selected {
      border-color: var(--accent-green);
      background: rgba(0,255,170,0.1);
    }

    .plan-name {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .plan-price {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-green);
      margin-bottom: 0.5rem;
    }

    .plan-features {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      display: inline-block;
    }

    .btn-block {
      width: 100%;
    }

    .btn-primary {
      background: var(--accent-blue);
      color: #000;
    }

    .btn-success {
      background: var(--accent-green);
      color: #000;
    }

    .btn-danger {
      background: var(--accent-red);
      color: #fff;
    }

    .btn-warning {
      background: var(--accent-orange);
      color: #000;
    }

    /* Main App */
    .header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-light);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-text {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-badge {
      background: var(--accent-blue);
      color: #000;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 1.5rem;
    }

    .sidebar {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .nav-item {
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .nav-item:hover {
      background: var(--bg-hover);
    }

    .nav-item.active {
      background: var(--accent-blue);
      color: #000;
    }

    .main-content {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .metric-card {
      background: var(--bg-hover);
      padding: 1.25rem;
      border-radius: 8px;
      border-left: 4px solid var(--accent-blue);
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 0.25rem;
    }

    .table-container {
      overflow-x: auto;
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--bg-hover);
    }

    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    th {
      background: var(--bg-card);
      color: var(--text-secondary);
      font-weight: 600;
    }

    .long { color: var(--accent-green); font-weight: bold; }
    .short { color: var(--accent-red); font-weight: bold; }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem;
      border-radius: 8px;
      z-index: 1001;
      max-width: 300px;
      animation: slideIn 0.3s ease;
    }

    .notification.success { background: var(--accent-green); color: #000; }
    .notification.error { background: var(--accent-red); color: #fff; }
    .notification.info { background: var(--accent-blue); color: #000; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .dashboard-grid { grid-template-columns: 1fr; }
      .header { padding: 1rem; flex-direction: column; gap: 1rem; }
      .container { padding: 1rem; }
    }
  </style>
</head>
<body>
  <!-- Auth Modal -->
  <div id="authModal" class="auth-modal">
    <div class="auth-content">
      <div class="auth-tabs">
        <div class="auth-tab active" onclick="showAuthTab('login')">Giri Yap</div>
        <div class="auth-tab" onclick="showAuthTab('register')">Kay覺t Ol</div>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="auth-form active">
        <h3 style="text-align: center; margin-bottom: 1.5rem;">TrendMaster AI'ya Ho Geldiniz</h3>
        
        <div class="form-group">
          <label for="loginEmail">E-posta</label>
          <input type="email" id="loginEmail" class="form-control" placeholder="ornek@email.com">
        </div>

        <div class="form-group">
          <label for="loginPassword">ifre</label>
          <input type="password" id="loginPassword" class="form-control" placeholder="ifreniz">
        </div>

        <button onclick="login()" class="btn btn-primary btn-block">Giri Yap</button>
        
        <p style="text-align: center; margin-top: 1rem; color: var(--text-muted);">
          Demo giri: admin@trendmaster.com / admin123
        </p>
      </div>

      <!-- Register Form -->
      <div id="registerForm" class="auth-form">
        <h3 style="text-align: center; margin-bottom: 1.5rem;">Yeni Hesap Olutur</h3>
        
        <div class="form-group">
          <label for="regFullName">Tam Ad覺n覺z</label>
          <input type="text" id="regFullName" class="form-control" placeholder="Ad Soyad">
        </div>

        <div class="form-group">
          <label for="regEmail">E-posta</label>
          <input type="email" id="regEmail" class="form-control" placeholder="ornek@email.com">
        </div>

        <div class="form-group">
          <label for="regPassword">ifre</label>
          <input type="password" id="regPassword" class="form-control" placeholder="En az 6 karakter">
        </div>

        <div class="form-group">
          <label for="regPhone">Telefon (Opsiyonel)</label>
          <input type="tel" id="regPhone" class="form-control" placeholder="+90 5XX XXX XX XX">
        </div>

        <div class="form-group">
          <label>Abonelik Plan覺</label>
          <div class="subscription-plans">
            <div class="plan-card" onclick="selectPlan('basic')">
              <div class="plan-name"> Basic</div>
              <div class="plan-price">$0/ay</div>
              <div class="plan-features">Sinyal 襤zleme</div>
            </div>
            <div class="plan-card" onclick="selectPlan('pro')">
              <div class="plan-name"> Pro</div>
              <div class="plan-price">$49/ay</div>
              <div class="plan-features">Manuel Trade</div>
            </div>
            <div class="plan-card" onclick="selectPlan('elite')">
              <div class="plan-name"> Elite</div>
              <div class="plan-price">$99/ay</div>
              <div class="plan-features">Auto Trade + Destek</div>
            </div>
          </div>
        </div>

        <button onclick="register()" class="btn btn-success btn-block">Kay覺t Ol ve de</button>
        
        <p style="text-align: center; margin-top: 1rem; color: var(--text-muted); font-size: 0.8rem;">
          3 g羹nl羹k 羹cretsiz deneme s羹reniz bulunmaktad覺r
        </p>
      </div>
    </div>
  </div>

  <!-- Main App (hidden until auth) -->
  <div id="app" style="display: none;">
    <header class="header">
      <div class="logo-text">
        TrendMaster AI 
        <span style="font-size:0.8rem;background:var(--accent-blue);color:black;padding:2px 6px;border-radius:4px">
          MULTI-USER v1.0
        </span>
      </div>
      
      <div class="user-info">
        <span id="userEmail"></span>
        <span id="userPlan" class="user-badge"></span>
        <button onclick="logout()" class="btn btn-danger">覺k覺</button>
      </div>
    </header>

    <div class="container">
      <div class="dashboard-grid">
        <!-- Sidebar -->
        <div class="sidebar">
          <div class="nav-item active" onclick="showSection('dashboard')">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </div>
          <div class="nav-item" onclick="showSection('signals')">
            <i class="fas fa-bolt"></i> Sinyaller
          </div>
          <div class="nav-item" onclick="showSection('trading')">
            <i class="fas fa-chart-line"></i> Trading
          </div>
          <div class="nav-item" onclick="showSection('api-keys')">
            <i class="fas fa-key"></i> API Key'ler
          </div>
          <div class="nav-item" onclick="showSection('subscription')">
            <i class="fas fa-crown"></i> Abonelik
          </div>
          <div class="nav-item" onclick="showSection('admin')" id="adminNav" style="display: none;">
            <i class="fas fa-shield-alt"></i> Admin Panel
          </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
          <!-- Dashboard Section -->
          <div id="dashboardSection">
            <h2>Dashboard</h2>
            <div class="metrics-grid">
              <div class="metric-card">
                <div>Abonelik Durumu</div>
                <div class="metric-value" id="metricSubscription">---</div>
              </div>
              <div class="metric-card">
                <div>Kalan G羹n</div>
                <div class="metric-value" id="metricDaysLeft">---</div>
              </div>
              <div class="metric-card">
                <div>Toplam Sinyal</div>
                <div class="metric-value" id="metricSignals">---</div>
              </div>
              <div class="metric-card">
                <div>API Durumu</div>
                <div class="metric-value" id="metricApiStatus">---</div>
              </div>
            </div>

            <h3 style="margin-top: 2rem;">Son Sinyaller</h3>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Coin</th>
                    <th>Y繹n</th>
                    <th>Giri</th>
                    <th>TP/SL</th>
                    <th>G羹ven</th>
                    <th>Zaman</th>
                  </tr>
                </thead>
                <tbody id="signalsTable">
                  <tr>
                    <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                      <i class="fas fa-sync fa-spin"></i> Sinyaller y羹kleniyor...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Other sections will be implemented similarly -->
          <div id="signalsSection" style="display: none;">
            <h2>Canl覺 Sinyaller</h2>
            <div id="signalsContent"></div>
          </div>

          <div id="tradingSection" style="display: none;">
            <h2>Trading Panel</h2>
            <div id="tradingContent"></div>
          </div>

          <div id="apiKeysSection" style="display: none;">
            <h2>API Key Y繹netimi</h2>
            <div id="apiKeysContent"></div>
          </div>

          <div id="subscriptionSection" style="display: none;">
            <h2>Abonelik Y繹netimi</h2>
            <div id="subscriptionContent"></div>
          </div>

          <div id="adminSection" style="display: none;">
            <h2>Admin Panel</h2>
            <div id="adminContent"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global state
    let currentUser = null;
    let currentSection = 'dashboard';
    let selectedPlan = 'basic';

    // DOM Elements
    const authModal = document.getElementById('authModal');
    const app = document.getElementById('app');

    // Show auth tab
    function showAuthTab(tab) {
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tab + 'Form').classList.add('active');
    }

    // Select subscription plan
    function selectPlan(plan) {
      selectedPlan = plan;
      document.querySelectorAll('.plan-card').forEach(card => card.classList.remove('selected'));
      event.target.closest('.plan-card').classList.add('selected');
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div style="display:flex;align-items:center;gap:10px;">
          <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 5000);
    }

    // Login function
    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      if (!email || !password) {
        showNotification('L羹tfen t羹m alanlar覺 doldurun', 'error');
        return;
      }

      try {
        document.body.classList.add('loading');
        
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (data.success) {
          localStorage.setItem('token', data.token);
          currentUser = data.user;
          showNotification('Giri baar覺l覺!', 'success');
          initializeApp();
        } else {
          showNotification(data.error, 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showNotification('Giri s覺ras覺nda bir hata olutu', 'error');
      } finally {
        document.body.classList.remove('loading');
      }
    }

    // Register function
    async function register() {
      const userData = {
        email: document.getElementById('regEmail').value,
        password: document.getElementById('regPassword').value,
        fullName: document.getElementById('regFullName').value,
        phone: document.getElementById('regPhone').value,
        plan: selectedPlan
      };

      if (!userData.email || !userData.password || !userData.fullName) {
        showNotification('L羹tfen zorunlu alanlar覺 doldurun', 'error');
        return;
      }

      try {
        document.body.classList.add('loading');
        
        const response = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(userData)
        });

        const data = await response.json();

        if (data.success) {
          if (data.payment) {
            // Handle Stripe payment
            showNotification('Kay覺t baar覺l覺! deme sayfas覺na y繹nlendiriliyorsunuz...', 'success');
            // Here you would integrate with Stripe.js
          } else {
            showNotification('Kay覺t baar覺l覺! Admin onay覺 bekleniyor.', 'success');
            showAuthTab('login');
          }
        } else {
          showNotification(data.error, 'error');
        }
      } catch (error) {
        console.error('Registration error:', error);
        showNotification('Kay覺t s覺ras覺nda bir hata olutu', 'error');
      } finally {
        document.body.classList.remove('loading');
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('token');
      currentUser = null;
      authModal.style.display = 'flex';
      app.style.display = 'none';
      showNotification('覺k覺 yap覺ld覺', 'info');
    }

    // Initialize app after login
    function initializeApp() {
      authModal.style.display = 'none';
      app.style.display = 'block';
      
      // Update UI with user info
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userPlan').textContent = currentUser.subscriptionPlan.toUpperCase();
      
      // Show admin nav if user is admin
      if (currentUser.role === 'admin') {
        document.getElementById('adminNav').style.display = 'block';
      }
      
      // Load initial data
      loadDashboardData();
      
      // Connect to WebSocket
      connectWebSocket();
    }

    // Show section
    function showSection(section) {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      event.target.classList.add('active');
      
      document.querySelectorAll('[id$="Section"]').forEach(sec => sec.style.display = 'none');
      document.getElementById(section + 'Section').style.display = 'block';
      
      currentSection = section;
      
      // Load section-specific data
      switch(section) {
        case 'dashboard':
          loadDashboardData();
          break;
        case 'signals':
          loadSignals();
          break;
        case 'api-keys':
          loadApiKeys();
          break;
        case 'admin':
          loadAdminPanel();
          break;
      }
    }

    // Load dashboard data
    async function loadDashboardData() {
      try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/trading/signals', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        const data = await response.json();
        
        if (data.success) {
          updateSignalsTable(data.signals);
        }
        
        // Update metrics
        document.getElementById('metricSubscription').textContent = 
          currentUser.subscriptionStatus === 'active' ? 'AKT襤F' : 'PAS襤F';
        document.getElementById('metricSubscription').style.color = 
          currentUser.subscriptionStatus === 'active' ? 'var(--accent-green)' : 'var(--accent-red)';
          
        document.getElementById('metricApiStatus').textContent = 
          currentUser.hasTradingAccess ? 'AKT襤F' : 'PAS襤F';
        document.getElementById('metricApiStatus').style.color = 
          currentUser.hasTradingAccess ? 'var(--accent-green)' : 'var(--accent-red)';
          
      } catch (error) {
        console.error('Dashboard data error:', error);
      }
    }

    // Update signals table
    function updateSignalsTable(signals) {
      const tbody = document.getElementById('signalsTable');
      
      if (!signals || signals.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted);">
              Hen羹z sinyal bulunmamaktad覺r
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = signals.map(signal => `
        <tr>
          <td><strong>${signal.symbol}</strong></td>
          <td><span class="${signal.direction.toLowerCase()}">${signal.direction}</span></td>
          <td>${signal.entry}</td>
          <td>${signal.tp} / ${signal.sl}</td>
          <td>%${signal.confidence}</td>
          <td>${new Date(signal.timestamp).toLocaleTimeString()}</td>
        </tr>
      `).join('');
    }

    // Connect to WebSocket
    function connectWebSocket() {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      const ws = new WebSocket(`${protocol}//${window.location.host}?token=${token}`);
      
      ws.onopen = () => {
        console.log('WebSocket connected');
      };
      
      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        console.log('WebSocket message:', data);
        
        if (data.type === 'signal') {
          showNotification(`Yeni sinyal: ${data.data.symbol} - ${data.data.direction}`, 'info');
          if (currentSection === 'dashboard') {
            loadDashboardData();
          }
        }
      };
      
      ws.onclose = () => {
        console.log('WebSocket disconnected');
        // Reconnect after 5 seconds
        setTimeout(connectWebSocket, 5000);
      };
    }

    // Check if user is already logged in
    async function checkAuthStatus() {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      try {
        const response = await fetch('/api/auth/profile', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            currentUser = data.user;
            initializeApp();
          }
        }
      } catch (error) {
        console.error('Auth check error:', error);
        localStorage.removeItem('token');
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      checkAuthStatus();
      
      // Demo credentials for testing
      document.getElementById('loginEmail').value = 'admin@trendmaster.com';
      document.getElementById('loginPassword').value = 'admin123';
    });

    // Placeholder functions for other sections
    async function loadSignals() {
      document.getElementById('signalsContent').innerHTML = `
        <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
          <i class="fas fa-sync fa-spin"></i> Sinyaller y羹kleniyor...
        </div>
      `;
    }

    async function loadApiKeys() {
      document.getElementById('apiKeysContent').innerHTML = `
        <div style="max-width: 500px;">
          <h3>Bitget API Key Ekle</h3>
          <div class="form-group">
            <label>API Key</label>
            <input type="text" class="form-control" placeholder="Bitget API Key">
          </div>
          <div class="form-group">
            <label>Secret Key</label>
            <input type="password" class="form-control" placeholder="Bitget Secret">
          </div>
          <div class="form-group">
            <label>Passphrase</label>
            <input type="password" class="form-control" placeholder="Bitget Passphrase">
          </div>
          <button class="btn btn-success">API Key'i Kaydet</button>
        </div>
      `;
    }

    async function loadAdminPanel() {
      if (currentUser.role !== 'admin') return;
      
      document.getElementById('adminContent').innerHTML = `
        <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
          <i class="fas fa-sync fa-spin"></i> Admin panel y羹kleniyor...
        </div>
      `;
    }
  </script>
</body>
</html>
