<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Alphason Trader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Arial;background:#0b0e12;color:#e6edf3;margin:0}
    header{padding:16px 24px;border-bottom:1px solid #1f2328;display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:700;letter-spacing:.4px}
    .pill{padding:6px 10px;border:1px solid #30363d;border-radius:999px;background:#161b22;color:#c9d1d9;font-size:12px}
    main{padding:24px;max-width:1100px;margin:0 auto}
    .card{border:1px solid #30363d;border-radius:12px;padding:16px;background:#0d1117;margin-bottom:16px}
    .row{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px}
    .signal{border:1px solid #21262d;border-radius:10px;padding:12px;background:#0b0f14}
    .ok{color:#3fb950} .warn{color:#d29922}
    input,button{padding:8px 10px;border-radius:8px;border:1px solid #30363d;background:#0d1117;color:#e6edf3}
    button{cursor:pointer}
    .flex{display:flex;gap:8px}
  </style>
</head>
<body>
<header>
  <div class="brand">ALPHASON TRADER</div>
  <div class="pill">Multi-tenant</div>
</header>
<main>
  <div class="card" id="auth">
    <div class="flex">
      <input id="email" placeholder="Email">
      <input id="pass" type="password" placeholder="Şifre">
      <button onclick="login()">Giriş</button>
      <button onclick="register()">Kayıt</button>
    </div>
    <div id="me" style="margin-top:8px;opacity:.8"></div>
  </div>

  <div class="card">
    <div class="flex">
      <button onclick="loadStatus()">Durumu Yükle</button>
      <button onclick="scan()">Tarama Yap</button>
    </div>
    <div id="status" style="margin-top:8px">Durum:</div>
  </div>

  <div class="card">
    <div class="flex">
      <input id="symbol" placeholder="BTC/USDT">
      <input id="dir" placeholder="LONG_BREAKOUT">
      <input id="entry" placeholder="Giriş">
      <input id="tp" placeholder="TP">
      <input id="sl" placeholder="SL">
      <button onclick="manualTrade()">Manuel Trade</button>
    </div>
  </div>

  <div class="row" id="signals"></div>
</main>
<script>
let token=null; let ws=null;
async function api(path, method='GET', body=null){
  const res = await fetch(path,{ method, headers: { 'Content-Type':'application/json', ...(token?{'Authorization':'Bearer '+token}:{}) }, body: body?JSON.stringify(body):undefined });
  return await res.json();
}
async function register(){
  const email=document.getElementById('email').value, password=document.getElementById('pass').value;
  const r=await api('/api/auth/register','POST',{email,password}); if(r.success){ token=r.token; document.getElementById('me').innerText='Kayıt OK'; connectWS(); }
  else alert(r.error||'Hata');
}
async function login(){
  const email=document.getElementById('email').value, password=document.getElementById('pass').value;
  const r=await api('/api/auth/login','POST',{email,password}); if(r.success){ token=r.token; document.getElementById('me').innerText='Giriş OK'; connectWS(); }
  else alert(r.error||'Hata');
}
function connectWS(){ if(ws) ws.close(); ws=new WebSocket(`ws://${location.host}?token=${token}`); ws.onmessage=(ev)=>{ try{ const msg=JSON.parse(ev.data); if(msg.type==='signal_list') renderSignals(msg.data); }catch(e){} }; }
async function loadStatus(){
  const r=await api('/api/status'); if(!r.success) return alert(r.error||'Hata');
  document.getElementById('status').innerText=`Sinyal sayısı: ${r.signals.length} | Açık pozisyonlar: ${r.positions.length}`;
  renderSignals(r.signals);
}
async function scan(){ const r=await api('/api/signals/scan','POST'); if(!r.success) return alert(r.error||'Hata'); renderSignals(r.signals); }
function renderSignals(list){
  const box=document.getElementById('signals'); box.innerHTML='';
  list.forEach(sig=>{
    const el=document.createElement('div'); el.className='signal';
    el.innerHTML=`<div><b>${sig.ccxt_symbol}</b> — ${sig.taraf}</div>
      <div>Giriş: ${sig.giris} • TP: ${sig.tp1} • SL: ${sig.sl}</div>
      <div>Güven: <span class="${sig.confidence>=80?'ok':'warn'}">${sig.confidence}%</span> • Kalite: ${sig.signalQuality}</div>
      <div>RR: ${sig.riskReward} • ADX: ${sig.adx} • RSI: ${sig.rsi}</div>
      <div style="opacity:.8">${sig.tuyo}</div>`;
    box.appendChild(el);
  });
}
async function manualTrade(){
  const symbol=document.getElementById('symbol').value||'BTC/USDT';
  const taraf=document.getElementById('dir').value||'LONG_BREAKOUT';
  const giris=parseFloat(document.getElementById('entry').value||'0');
  const tp1=parseFloat(document.getElementById('tp').value||'0');
  const sl=parseFloat(document.getElementById('sl').value||'0');
  const r=await api('/api/trade/manual','POST',{ ccxt_symbol:symbol, taraf, giris, tp1, sl, confidence:90, positionSize:1.0 });
  if(!r.success) return alert(r.error||'Hata');
  alert('Manuel trade gönderildi');
}
</script>
</body>
</html>
