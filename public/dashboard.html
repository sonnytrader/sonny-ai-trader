<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Alphason Trader - Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- TailwindCSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-gray-900 to-black text-white min-h-screen">
  <!-- Header -->
  <header class="flex justify-between items-center px-8 py-4 border-b border-gray-700">
    <h1 class="text-2xl font-bold text-blue-400">ALPHASON DASHBOARD</h1>
    <div id="userInfo" class="text-sm text-gray-300"></div>
  </header>

  <!-- Main -->
  <main class="p-8 grid md:grid-cols-3 gap-8">
    <!-- Sistem Durumu -->
    <div class="bg-gray-800 rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-blue-300 mb-4">ğŸ“Š Sistem Durumu</h3>
      <div id="status">YÃ¼kleniyor...</div>
      <button onclick="loadStatus()" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg">Durumu Yenile</button>
    </div>

    <!-- Tarama -->
    <div class="bg-gray-800 rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-green-300 mb-4">ğŸ” Tarama</h3>
      <button onclick="scan()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg">Tarama Yap</button>
      <div id="scanMsg" class="mt-4 text-gray-400"></div>
    </div>

    <!-- Stratejiler -->
    <div class="bg-gray-800 rounded-xl shadow-lg p-6">
      <h3 class="text-xl font-semibold text-purple-300 mb-4">âš™ï¸ Stratejiler</h3>
      <div id="strategies" class="text-gray-300">YÃ¼kleniyor...</div>
    </div>

    <!-- Manuel Trade -->
    <div class="bg-gray-800 rounded-xl shadow-lg p-6 md:col-span-3">
      <h3 class="text-xl font-semibold text-yellow-300 mb-4">ğŸ–ï¸ Manuel Trade</h3>
      <div class="grid md:grid-cols-6 gap-4">
        <input id="symbol" placeholder="BTC/USDT" class="p-2 rounded bg-gray-900 border border-gray-700">
        <select id="dir" class="p-2 rounded bg-gray-900 border border-gray-700">
          <option value="LONG_BREAKOUT">LONG_BREAKOUT</option>
          <option value="SHORT_BREAKOUT">SHORT_BREAKOUT</option>
        </select>
        <input id="entry" placeholder="GiriÅŸ" class="p-2 rounded bg-gray-900 border border-gray-700">
        <input id="tp" placeholder="TP" class="p-2 rounded bg-gray-900 border border-gray-700">
        <input id="sl" placeholder="SL" class="p-2 rounded bg-gray-900 border border-gray-700">
        <button onclick="manualTrade()" class="bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg">GÃ¶nder</button>
      </div>
    </div>

    <!-- Sinyaller -->
    <div class="bg-gray-800 rounded-xl shadow-lg p-6 md:col-span-3">
      <h3 class="text-xl font-semibold text-blue-400 mb-4">ğŸ“ˆ Sinyaller</h3>
      <div id="signals" class="grid md:grid-cols-2 gap-4"></div>
    </div>
  </main>

<script>
const token = localStorage.getItem('token');
if(!token){ alert('Token yok, Ã¶nce giriÅŸ yapÄ±n.'); window.location.href='index.html'; }

async function api(path, method='GET', body=null){
  const res = await fetch(path,{
    method,
    headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+token },
    body: body?JSON.stringify(body):undefined
  });
  return await res.json();
}

async function loadStatus(){
  const r = await api('/api/status');
  if(!r.success){ document.getElementById('status').innerText='Hata: '+(r.error||''); return; }
  document.getElementById('status').innerText=`Sinyal: ${r.signals.length} | Pozisyon: ${r.positions.length}`;
  renderSignals(r.signals);
}

async function scan(){
  const r = await api('/api/signals/scan','POST');
  if(!r.success){ document.getElementById('scanMsg').innerText='Hata: '+(r.error||''); return; }
  document.getElementById('scanMsg').innerText=`${r.signals.length} sinyal bulundu.`;
  renderSignals(r.signals);
}

async function manualTrade(){
  const body={
    ccxt_symbol:document.getElementById('symbol').value||'BTC/USDT',
    taraf:document.getElementById('dir').value,
    giris:parseFloat(document.getElementById('entry').value||'0'),
    tp1:parseFloat(document.getElementById('tp').value||'0'),
    sl:parseFloat(document.getElementById('sl').value||'0'),
    confidence:90, positionSize:1.0
  };
  const r = await api('/api/trade/manual','POST',body);
  alert(r.success?'Manuel trade gÃ¶nderildi':'Hata: '+(r.error||''));
}

async function loadConfig(){
  const r = await api('/api/user/config');
  if(!r.success){ document.getElementById('strategies').innerText='Config yÃ¼klenemedi'; return; }
  const allowed = r.config.allowedStrategies.split(',');
  document.getElementById('strategies').innerText='Aktif stratejiler: '+allowed.join(', ');
}

function renderSignals(list){
  const box=document.getElementById('signals'); box.innerHTML='';
  list.forEach(s=>{
    const el=document.createElement('div'); el.className='p-4 bg-gray-900 rounded-lg border border-gray-700';
    el.innerHTML=`<div class="font-bold text-lg">${s.ccxt_symbol} â€” ${s.taraf}</div>
      <div class="text-gray-400">GiriÅŸ: ${s.giris} â€¢ TP: ${s.tp1} â€¢ SL: ${s.sl}</div>
      <div>GÃ¼ven: <span class="${s.confidence>=80?'text-green-400':'text-yellow-400'}">${s.confidence}%</span> â€¢ Kalite: ${s.signalQuality}</div>
      <div>RR: ${s.riskReward} â€¢ ADX: ${s.adx} â€¢ RSI: ${s.rsi}</div>
      <div class="text-sm text-gray-500">${s.tuyo}</div>`;
    box.appendChild(el);
  });
}

// BaÅŸlangÄ±Ã§ta yÃ¼kle
loadStatus();
loadConfig();
</script>
</body>
</html>
