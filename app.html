<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Sonny AI Trader - Trend Breakout</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background:#05070D; color:#fff; font-family:Segoe UI, sans-serif; }
    .header { background:#101522; padding:1rem; display:flex; justify-content:space-between; align-items:center; }
    .logo { font-weight:700; font-size:1.2rem; color:#00BFFF; }
    .container { max-width:1200px; margin:2rem auto; padding:1rem; }
    .signal-table { width:100%; border-collapse:collapse; background:#101522; border-radius:8px; overflow:hidden; }
    th, td { padding:0.8rem 1rem; border-bottom:1px solid rgba(255,255,255,0.1); }
    th { text-transform:uppercase; font-size:0.8rem; color:#B0C4DE; }
    td { font-size:0.9rem; }
    .long { color:#00FFAA; font-weight:600; }
    .short { color:#FF4D4D; font-weight:600; }
    .confidence-bar { height:6px; background:#1A2235; border-radius:3px; overflow:hidden; margin-top:4px; }
    .confidence-fill { height:100%; background:#00BFFF; }
    button { padding:0.4rem 0.8rem; border:none; border-radius:6px; cursor:pointer; background:#00BFFF; color:#000; font-weight:600; }
    button:hover { background:#0099CC; }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo"><i class="fas fa-bolt"></i> Sonny AI Trader</div>
    <div id="connectionStatus"><i class="fas fa-circle"></i> Bağlanıyor...</div>
  </header>

  <div class="container">
    <h2>Trend Breakout Sinyalleri</h2>
    <table class="signal-table">
      <thead>
        <tr>
          <th>Coin</th>
          <th>Yön</th>
          <th>Açıklama</th>
          <th>Kırılım Fiyatı</th>
          <th>Giriş Fiyatı</th>
          <th>Confidence</th>
          <th>İşlem</th>
        </tr>
      </thead>
      <tbody id="signalsBody">
        <tr><td colspan="7" style="text-align:center; padding:1.5rem; color:#708090;">Henüz sinyal yok</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    let ws;
    document.addEventListener('DOMContentLoaded', connectWS);

    function connectWS() {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      const wsUrl = protocol + '//' + window.location.host;
      ws = new WebSocket(wsUrl);

      ws.onopen = () => {
        document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle long"></i> Bağlı';
      };

      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data || '{}');
          if (data.type === 'trend_signals') {
            renderSignals(data.data || []);
          }
        } catch (err) { console.error('WS parse error', err); }
      };

      ws.onclose = () => {
        document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle short"></i> Bağlantı Kesildi';
      };
    }

    function renderSignals(signals) {
      const tbody = document.getElementById('signalsBody');
      if (!signals.length) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:1.5rem; color:#708090;">Henüz sinyal yok</td></tr>';
        return;
      }
      tbody.innerHTML = signals.map(s => `
        <tr>
          <td>${s.symbol}</td>
          <td class="${s.signal === 'LONG' ? 'long' : 'short'}">${s.signal}</td>
          <td>${s.reason}</td>
          <td>${s.breakoutPrice}</td>
          <td>${s.entryPrice}</td>
          <td>
            <div class="confidence-bar">
              <div class="confidence-fill" style="width:${s.confidence || 0}%"></div>
            </div>
            ${s.confidence || 0}%
          </td>
          <td><button onclick="alert('İşlem: ${s.signal} ${s.symbol} @ ${s.entryPrice}')">Uygula</button></td>
        </tr>
      `).join('');
    }
  </script>
</body>
</html>
