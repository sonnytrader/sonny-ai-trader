<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonny AI Trader - Trend Breakout Cockpit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Senin gönderdiğin cockpit CSS yapısı korunuyor */
        :root {
            --bg-dark: #05070D; --bg-card: #101522; --bg-hover: #1A2235;
            --accent-blue: #00BFFF; --accent-green: #00FFAA; --accent-red: #FF4D4D;
            --text-primary: #FFFFFF; --text-secondary: #B0C4DE; --text-muted: #708090;
            --border-light: rgba(173, 216, 230, 0.15);
        }
        body { background: var(--bg-dark); color: var(--text-primary); font-family: 'Segoe UI', sans-serif; }
        .header { background: var(--bg-card); padding: 1rem 2rem; border-bottom: 1px solid var(--border-light); }
        .header-content { display:flex; justify-content:space-between; align-items:center; }
        .logo { display:flex; align-items:center; gap:12px; font-weight:700; font-size:1.2rem; color:var(--accent-blue); }
        .container { max-width:1800px; margin:0 auto; padding:1.5rem 2rem; }
        .metrics-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem; margin-bottom:1.5rem; }
        .metric-card { background:var(--bg-card); border-radius:8px; padding:1rem; border:1px solid var(--border-light); }
        .metric-label { color:var(--text-secondary); font-size:0.85rem; text-transform:uppercase; }
        .metric-value { font-size:1.5rem; font-weight:700; margin-top:0.25rem; }
        .metric-positive { color:var(--accent-green); } .metric-negative { color:var(--accent-red); }
        .table-container { background:var(--bg-card); border:1px solid var(--border-light); border-radius:12px; overflow-x:auto; margin-bottom:1.5rem; }
        .table-header { background:var(--bg-hover); padding:1rem; border-bottom:1px solid var(--border-light); }
        .table-title { font-size:1.1rem; font-weight:600; color:var(--text-primary); display:flex; align-items:center; gap:0.75rem; }
        table { width:100%; border-collapse:collapse; min-width:1000px; }
        th, td { padding:0.8rem 1rem; border-bottom:1px solid var(--border-light); font-size:0.9rem; }
        th { text-transform:uppercase; font-size:0.8rem; color:var(--text-secondary); }
        .direction-long { color:var(--accent-green); font-weight:600; }
        .direction-short { color:var(--accent-red); font-weight:600; }
        .confidence-bar { width:70px; height:6px; background:var(--bg-hover); border-radius:3px; overflow:hidden; }
        .confidence-fill { height:100%; background:var(--accent-blue); }
        .btn { padding:0.4rem 0.8rem; border:none; border-radius:6px; cursor:pointer; font-size:0.8rem; font-weight:600; background:var(--accent-blue); color:#000; }
        .btn:hover { background:#0099CC; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo"><i class="fas fa-bolt"></i> Sonny AI Trader <span style="background:var(--accent-blue);color:#000;padding:2px 6px;border-radius:6px;font-size:0.7rem;">Trend Breakout</span></div>
            <div class="connection-status" id="connectionStatus"><i class="fas fa-circle"></i><span>Bağlanıyor...</span></div>
        </div>
    </header>

    <div class="container">
        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card"><div class="metric-label">Toplam Bakiye</div><div class="metric-value" id="metricEquity">$---</div></div>
            <div class="metric-card"><div class="metric-label">Kullanılabilir</div><div class="metric-value" id="metricAvailable">$---</div></div>
            <div class="metric-card"><div class="metric-label">Açık PNL</div><div class="metric-value" id="metricPnl">$0.00</div></div>
            <div class="metric-card"><div class="metric-label">Günlük K/Z</div><div class="metric-value" id="metricDailyPL">$0.00</div></div>
            <div class="metric-card"><div class="metric-label">Günlük İşlem</div><div class="metric-value" id="metricDailyTrades">0</div></div>
        </div>

        <!-- Trend Breakout Signals Table -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-title"><i class="fas fa-chart-line"></i> Trend Breakout Sinyalleri <span class="ai-badge" id="trendSignalsCount" style="background:var(--accent-blue);color:#000;padding:3px 8px;border-radius:6px;font-size:0.75rem;">0</span></div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Coin</th>
                        <th>Yön</th>
                        <th>Açıklama</th>
                        <th>Kırılım Fiyatı</th>
                        <th>Giriş Fiyatı</th>
                        <th>Confidence</th>
                        <th>İşlem</th>
                    </tr>
                </thead>
                <tbody id="trendSignalsBody">
                    <tr><td colspan="7" style="text-align:center;color:var(--text-muted);padding:2rem;">Trend Breakout taranıyor...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let wsConnection;
        document.addEventListener('DOMContentLoaded', connectWebSocket);

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = protocol + '//' + window.location.host;
            wsConnection = new WebSocket(wsUrl);

            wsConnection.onopen = () => {
                document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle direction-long"></i><span>Bağlı</span>';
            };

            wsConnection.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data || '{}');
                    if (data.type === 'trend_signals') renderTrendSignals(data.data || []);
                } catch (err) { console.error('WS parse error', err); }
            };

            wsConnection.onclose = () => {
                document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle direction-short"></i><span>Bağlantı Kesildi</span>';
            };
        }

        function renderTrendSignals(signals) {
            const tbody = document.getElementById('trendSignalsBody');
            const count = document.getElementById('trendSignalsCount');
            if (!signals.length) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--text-muted);">Henüz sinyal yok</td></tr>';
                count.textContent = 0;
                return;
            }
            count.textContent = signals.length;
            tbody.innerHTML = signals.map(s => `
                <tr>
                    <td>${s.symbol}</td>
                    <td class="${s.signal === 'LONG' ? 'direction-long' : 'direction-short'}">${s.signal}</td>
                    <td>${s.reason}</td>
                    <td>${s.breakoutPrice}</td>
                    <td>${s.entryPrice}</td>
                    <td>
                        <div class="confidence-bar"><div class="confidence-fill" style="width:${s.confidence}%"></div></div>
                        ${s.confidence}%
                    </td>
                    <td><button class="btn" onclick="alert('İşlem: ${s.signal} ${s.symbol} @ ${s.entry
