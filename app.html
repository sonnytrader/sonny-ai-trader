<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonny AI Trader (V14.13 - UYUMLU)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <style>
        /* TÃœM CSS HATALARI DÃœZELTÄ°LDÄ° */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 0; font-size: 0.85rem; }
        .container-fluid { padding: 1.5rem; max-width: 1800px; }
        .card { background-color: #1e1e1e; border: 1px solid #333; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); margin-bottom: 1.5rem; overflow: hidden; }
        .card-header { background-color: #2a2a2a; border-bottom: 1px solid #333; color: #e0e0e0; font-weight: bold; padding: 0.75rem 1rem; }
        .card-body { padding: 1rem; }
        header { padding: 20px; background-color: #2a2a2a; border-bottom: 1px solid #333; text-align: center; margin-bottom: 1.5rem; border-radius: 8px 8px 0 0; }
        header h1 { color: #4CAF50; margin: 0; font-size: 1.6em;}
        #scan-status { font-size: 0.9em; color: #bbb; margin-top: 8px; display: flex; align-items: center; justify-content: center; }
        #scan-spinner { width: 16px; height: 16px; border: 2px solid #555; border-top-color: #4CAF50; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; display: none; }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        @keyframes highlight { 
            from { background-color: rgba(76, 175, 80, 0.5); } 
            to { background-color: inherit; } 
        }

        .new-signal-row { animation: highlight 1.5s ease-out; }
        .manual-analysis { padding: 15px 20px; background-color: #252525; display: flex; gap: 10px; flex-direction: column; border-bottom: 1px solid #333;}
        .manual-input-row { display: flex; gap: 10px; }
        .manual-analysis input[type="text"] { flex-grow: 1; padding: 8px; background-color: #333; border: 1px solid #444; border-radius: 4px; color: #fff; font-size: 0.9em; }
        .manual-analysis button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; font-size: 0.9em; }
        .manual-analysis button:hover:not(:disabled) { background-color: #45a049; }
        .manual-analysis button:disabled { background-color: #555; cursor: not-allowed; }
        #manual-result-wrapper { position: relative; padding: 10px; margin-top: 10px; border-radius: 6px; background-color: #333; box-shadow: inset 0 1px 3px rgba(0,0,0,0.4); display: none; font-size: 0.9em;}
        .manual-close-btn { position: absolute; top: 2px; right: 8px; background: none; border: none; color: #ccc; font-size: 1.2em; cursor: pointer; }
        .manual-result-title { font-weight: bold; margin-bottom: 5px; color: #4CAF50; }
        .manual-result-text p { margin-bottom: 0.4rem; }
        .manual-signal-box { font-size: 0.9em; padding: 2px 6px; }
        .bg-long, .signal-long { background-color: #1a7a3a !important; color: white !important; }
        .bg-short, .signal-short { background-color: #9d3131 !important; color: white !important; }
        .bg-pump { background-color: #0d6efd !important; color: white !important; font-weight: bold;}
        .bg-dump { background-color: #dc3545 !important; color: white !important; font-weight: bold;}
        .bg-wait, .signal-wait { background-color: #6c757d !important; color: white !important; }
        .status-reddet, .signal-filtered { background-color: #495057 !important; color: #adb5bd !important; font-style: italic; }
        .status-onay { color: #198754; font-weight: bold; }
        .strategy-stochema { font-size: 0.8em; color: #adb5bd; } .strategy-breakout { font-size: 0.8em; color: #64b5f6; font-weight: bold; } .strategy-momentum { font-size: 0.8em; color: #ffc107; font-weight: bold; }
        .volume-low { background-color: #664d03; color: #ffc107; } .volume-very-low { background-color: #842029; color: #f8d7da; } .volume-ok, .volume-enough { background-color: #0f5132; color: #d1e7dd; }
        td span.volume-span { padding: 3px 6px; border-radius: 0.25rem; font-weight: bold; display: inline-block; font-size: 0.9em;}
        .teyit-uyumlu { color: #198754; font-weight: bold; } .teyit-zayif { color: #ffc107; font-weight: bold; } .teyit-ters { color: #dc3545; font-weight: bold; } .teyit-baslik { color: #6c757d; font-weight: bold; }
        .table-wrapper { overflow-x: auto; padding: 15px 20px; background-color: #1e1e1e; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); margin-bottom: 1.5rem;}
        table { width: 100%; border-collapse: collapse; margin-bottom: 0; table-layout: fixed; background-color: #1e1e1e; }
        th, td { padding: 9px 11px; text-align: left; border-bottom: 1px solid #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; }
        th { background-color: #2a2a2a; cursor: pointer; user-select: none; position: sticky; top: 0; z-index: 10; }
        th:hover { background-color: #333; }
        th .sort-icon { margin-left: 5px; font-size: 0.8em; }
        tbody tr:hover { background-color: #303030; }
        .main-signal-table th:nth-child(1), .main-signal-table td:nth-child(1) { width: 65px; } .main-signal-table th:nth-child(2), .main-signal-table td:nth-child(2) { width: 170px; white-space: normal !important;} .main-signal-table th:nth-child(3), .main-signal-table td:nth-child(3) { width: 65px; text-align: center;} .main-signal-table th:nth-child(4), .main-signal-table td:nth-child(4) { width: 75px; text-align: right;} .main-signal-table th:nth-child(5), .main-signal-table td:nth-child(5) { width: 100px; text-align: right;} .main-signal-table th:nth-child(6), .main-signal-table td:nth-child(6) { width: 160px; } .main-signal-table th:nth-child(7), .main-signal-table td:nth-child(7) { width: 70px; text-align: right;} .main-signal-table th:nth-child(8), .main-signal-table td:nth-child(8) { width: 80px; text-align: right;} .main-signal-table th:nth-child(9), .main-signal-table td:nth-child(9) { width: 140px; } 
        .main-signal-table th:nth-child(10),.main-signal-table td:nth-child(10) { width: auto; white-space: normal !important; min-width: 300px; }
        
        .momentum-table th:nth-child(1), .momentum-table td:nth-child(1) { width: 65px; } /* Zaman */
        .momentum-table th:nth-child(2), .momentum-table td:nth-child(2) { width: 130px; } /* Sembol */
        .momentum-table th:nth-child(3), .momentum-table td:nth-child(3) { width: 80px; text-align: center; } /* Sinyal */
        .momentum-table th:nth-child(4), .momentum-table td:nth-child(4) { width: 100px; text-align: right; } /* GiriÅŸ */
        .momentum-table th:nth-child(5), .momentum-table td:nth-child(5) { width: auto; min-width: 200px; } /* AÃ§Ä±klama */

        .watchlist-table th:nth-child(1), .watchlist-table td:nth-child(1) { width: 65px; } .watchlist-table th:nth-child(2), .watchlist-table td:nth-child(2) { width: 150px; } .watchlist-table th:nth-child(3), .watchlist-table td:nth-child(3) { width: 70px; text-align: center; } .watchlist-table th:nth-child(4), .watchlist-table td:nth-child(4) { width: 100px; text-align: right; } .watchlist-table th:nth-child(5), .watchlist-table td:nth-child(5) { width: 160px; } .watchlist-table th:nth-child(6), .watchlist-table td:nth-child(6) { width: 70px; text-align: right; } .watchlist-table th:nth-child(7), .watchlist-table td:nth-child(7) { width: 80px; text-align: right; } .watchlist-table th:nth-child(8), .watchlist-table td:nth-child(8) { width: 140px; } .watchlist-table th:nth-child(9), .watchlist-table td:nth-child(9) { width: auto; white-space: normal !important; min-width: 300px;} .watchlist-table th:nth-child(10),.watchlist-table td:nth-child(10){ width: 80px; text-align: center;}
        .link-text { color: #64b5f6; text-decoration: none; } .link-text:hover { text-decoration: underline; }
        .filter-section { padding: 10px 20px; background-color: #252525; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; border-radius: 6px; margin-bottom: 1rem;}
        .filter-section label { font-weight: bold; font-size: 0.9em; margin-right: 5px;} .filter-section input[type="number"] { width: 60px; padding: 5px; background-color: #333; border: 1px solid #444; border-radius: 4px; color: #fff; font-size: 0.9em; } .filter-section button { padding: 5px 12px; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; font-size: 0.9em;}
        #apply-filter-button { background-color: #4CAF50; } #show-all-button { background-color: #6c757d; }
        .strategy-filter-container { display: flex; gap: 10px; padding: 10px 20px 0 20px; margin-bottom: 1rem; }
        .btn-filter { background-color: #444; color: #ccc; border: 1px solid #666; padding: 5px 12px; border-radius: 4px; cursor: pointer; transition: all 0.2s; font-weight: 600; font-size: 0.8em; }
        .btn-filter.active { background-color: #4CAF50; color: white; border-color: #4CAF50; } .btn-filter:hover { background-color: #555; }
        h2 { font-size: 1.1rem; color: #adb5bd; margin: 1.5rem 0 0.75rem 0; padding: 0 20px; border-bottom: 1px solid #444; padding-bottom: 0.5rem;}
        .scrollable-table { max-height: 450px; overflow-y: auto; }
        #momentum-table-container.scrollable-table { max-height: 300px; } #signal-table-container.scrollable-table { max-height: 600px; } #watchlist-table-container.scrollable-table { max-height: 350px; }
Â  Â  </style>
</head>
<body>

Â  Â  <div class="container-fluid">
Â  Â  Â  Â  <header>
            Â  Â  Â  Â  Â  Â  <h1>Sonny AI Trader (V14.13 UYUMLU)</h1>
Â  Â  Â  Â  Â  Â  <div id="scan-status">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="scan-spinner"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="scan-status-text">Sunucuya baÄŸlanÄ±lÄ±yor...</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <div class="manual-analysis">
Â  Â  Â  Â  Â  Â  <div class="manual-input-row">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="symbol-input" placeholder="Manuel Analiz & Takip Et (Ã¶rn: BTC)">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="analyze-button">Analiz Et & Takip Et</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="manual-result-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="manual-close-btn" id="manual-close-btn">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="manual-result"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="table-container">
            Â  Â  Â  Â  Â  Â  <h2>âš¡ Momentum (5M Hacim)</h2>
Â  Â  Â  Â  Â  Â  <div id="momentum-table-container" class="table-wrapper scrollable-table">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="momentum-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead> <tr> <th>Zaman</th> <th>Sembol</th> <th>Sinyal</th> <th>GiriÅŸ</th> <th>AÃ§Ä±klama (Hacim/Fiyat)</th> </tr> </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="momentum-table-body">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="5" class="text-center text-muted py-3">HenÃ¼z momentum sinyali yok.</td></tr>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="table-container">
Â  Â  Â  Â  Â  Â  <h2>â¤ï¸ Takip Listesi (Watchlist)</h2>
Â  Â  Â  Â  Â  Â  <div id="watchlist-table-container" class="table-wrapper scrollable-table">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="watchlist-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead> <tr> <th data-sort-wl="timestamp">Zaman</th> <th data-sort-wl="symbol">Sembol (Strateji)</th> <th data-sort-wl="signal">YÃ¶n</th> <th>GiriÅŸ FiyatÄ±</th> <th>TP / SL</th> <th data-sort-wl="RR">R/R</th> <th data-sort-wl="bbWidth">BBW %</th> <th data-sort-wl="volumeStatus">Hacim</th> <th class="reason-cell">AÃ§Ä±klama</th> <th>Ä°ÅŸlem</th> </tr> </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="watchlist-table-body"> <tr><td colspan="10" class="text-center text-muted py-3">Liste boÅŸ veya yÃ¼kleniyor...</td></tr> </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="table-container">
Â  Â  Â  Â  Â  Â  <h2>ğŸ“ˆ KÄ±rÄ±lÄ±m Sinyalleri (1H/2H/4H)</h2>
Â  Â  Â  Â  Â  Â  <div class="filter-section">
Â  Â  Â  Â  Â  Â  Â  Â  <label for="confidence-threshold">Min. GÃ¼ven:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="confidence-threshold" value="0" min="0" max="100">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="apply-filter-button">Filtrele</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="show-all-button">TÃ¼mÃ¼nÃ¼ GÃ¶ster</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-left: auto;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-filter active" id="filter-all" data-strategy="ALL">TÃœMÃœ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-filter" data-strategy="BRK1H">BRK 1H</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-filter" data-strategy="BRK2H">BRK 2H</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-filter" data-strategy="BRK4H">BRK 4H</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="signal-table-container" class="table-wrapper scrollable-table">
Â  Â  Â  Â  Â  Â  Â  Â  <table class="main-signal-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead> <tr> <th data-sort="timestamp" class="sorted-asc">Zaman <span class="sort-icon">&#9660;</span></th> <th data-sort="symbol">Sembol (Strateji)</th> <th data-sort="signal">YÃ¶n</th> <th data-sort="confidence">GÃ¼ven %</th> <th>GiriÅŸ FiyatÄ±</th> <th>TP / SL</th> <th data-sort="RR">R/R</th> <th data-sort="bbWidth">BBW %</th> <th data-sort="volumeStatus">Hacim</th> <th class="reason-cell">AÃ§Ä±klama / Strateji</th> </tr> </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="signal-table-body"> <tr><td colspan="10" class="text-center text-muted py-3">HenÃ¼z sinyal yok veya yÃ¼kleniyor...</td></tr> </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // --- GLOBAL DEÄÄ°ÅKENLER ---
Â  Â  Â  Â  const socket = io();
Â  Â  Â  Â  const signalTableBody = document.getElementById('signal-table-body');
Â  Â  Â  Â  const momentumTableBody = document.getElementById('momentum-table-body');
Â  Â  Â  Â  const watchlistTableBody = document.getElementById('watchlist-table-body');
Â  Â  Â  Â  const symbolInput = document.getElementById('symbol-input');
Â  Â  Â  Â  const analyzeButton = document.getElementById('analyze-button');
Â  Â  Â  Â  const manualResultWrapper = document.getElementById('manual-result-wrapper');
Â  Â  Â  Â  const manualResultDiv = document.getElementById('manual-result');
Â  Â  Â  Â  const manualCloseBtn = document.getElementById('manual-close-btn');
Â  Â  Â  Â  const confidenceThresholdInput = document.getElementById('confidence-threshold');
Â  Â  Â  Â  const applyFilterButton = document.getElementById('apply-filter-button');
Â  Â  Â  Â  const showAllButton = document.getElementById('show-all-button');
Â  Â  Â  Â  const scanStatusText = document.getElementById('scan-status-text');
Â  Â  Â  Â  const scanSpinner = document.getElementById('scan-spinner');

Â  Â  Â  Â  let allSignals = []; let momentumSignals = []; let currentWatchlist = {}; const MAX_MOMENTUM_SIGNALS = 50;
Â  Â  Â  Â  let mainSortState = { key: 'timestamp', direction: 'desc' }; let wlSortState = { key: 'timestamp', direction: 'desc' };
Â  Â  Â  Â  let currentThreshold = 0; let activeStrategyFilter = 'ALL';

Â  Â  Â  Â  // --- YardÄ±mcÄ± Fonksiyonlar ---
Â  Â  Â  Â  function formatTimestamp(timestamp) { if (!timestamp) return '---'; try { return new Date(timestamp).toLocaleTimeString('tr-TR'); } catch (e) { return 'Invalid Date'; } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [V14.13 GÃœNCELLEMESÄ°]
Â  Â  Â  Â  function getStrategyTag(strategyType) {
Â  Â  Â  Â  Â  Â  if (!strategyType) return '';
Â  Â  Â  Â  Â  Â  if (strategyType === 'MOMENTUM5M') return '<span class="strategy-momentum">(5M Mom.)</span>';
Â  Â  Â  Â  Â  Â  if (strategyType === 'BRK1H') return '<span class="strategy-breakout">(1H KÄ±r.)</span>';
Â  Â  Â  Â  Â  Â  if (strategyType === 'BRK2H') return '<span class="strategy-breakout">(2H KÄ±r.)</span>';
Â  Â  Â  Â  Â  Â  if (strategyType === 'BRK4H') return '<span class="strategy-breakout">(4H KÄ±r.)</span>';
Â  Â  Â  Â  Â  Â  if (strategyType === 'MANUAL') return '<span class="strategy-stochema">(Manual)</span>';
Â  Â  Â  Â  Â  Â  return `<span class="strategy-stochema">(${strategyType})</span>`; // DiÄŸer
Â  Â  Â  Â  }

Â  Â  Â  Â  // [V14.13 GÃœNCELLEMESÄ°]
Â  Â  Â  Â  function getVolumeClassAndText(signal) {Â 
Â  Â  Â  Â  Â  Â  let text = '---'; let className = '';Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (signal?.strategyType === 'MOMENTUM5M') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = signal.reason || '---';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const match = text.match(/Hacim: ([\d.]+)x/);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (match && match[1]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const multiplier = parseFloat(match[1]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (multiplier >= 5.0) className = 'volume-ok';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (multiplier >= 2.5) className = 'volume-enough';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else className = 'volume-low';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { className = 'volume-low'; } 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = signal.reason || '---';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (signal?.volumeStatus) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = signal.volumeStatus;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (text.includes('BALÄ°NA') || text.includes('YÃ¼ksek')) className = 'volume-ok';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (text.includes('Yeterli')) className = 'volume-enough';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (text.includes('DÃ¼ÅŸÃ¼k')) className = 'volume-low';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  } catch(e){ console.error("Volume Class Error:", e, signal);}Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (signal?.strategyType !== 'MOMENTUM5M' && signal?.volumeStatus) {
Â  Â  Â  Â  Â  Â  Â  Â  Â text = signal.volumeStatus;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (signal?.strategyType === 'MOMENTUM5M' && signal?.reason) {
Â  Â  Â  Â  Â  Â  Â  Â  text = signal.reason;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return `<span class="volume-span ${className}">${text}</span>`;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function formatReasonText(reason) {Â 
Â  Â  Â  Â  Â  Â  if (!reason) return '---';Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/âœ… \*\*Trend Dostu Sinyal:\*\*/g, '<span class="teyit-uyumlu">âœ… Trend Dostu:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/ğŸ‹ \*\*\'Balina Teyitli\':\*\*/g, '<span class="status-onay">ğŸ‹ Balina Teyitli:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/ğŸ‘ \*\*Hacim Teyitli:\*\*/g, '<span class="teyit-uyumlu">ğŸ‘ Hacim Teyitli:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/âš ï¸ \*\*YÃ¼ksek Risk \(Ters Trend\):\*\*/g, '<span class="teyit-ters">âš ï¸ Ters Trend:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/ğŸ‘ \*\*ZayÄ±f Hacim:\*\*/g, '<span class="teyit-zayif">ğŸ‘ ZayÄ±f Hacim:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/ğŸ¥µ \*\*AÅŸÄ±rÄ± ÅiÅŸmiÅŸ:\*\*/g, '<span class="teyit-zayif">ğŸ¥µ AÅŸÄ±rÄ± ÅiÅŸmiÅŸ:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/ğŸ¥¶ \*\*AÅŸÄ±rÄ± SatÄ±lmÄ±ÅŸ:\*\*/g, '<span class="teyit-zayif">ğŸ¥¶ AÅŸÄ±rÄ± SatÄ±lmÄ±ÅŸ:</span>');
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/FÄ°LTRELENDÄ°/g, '<span class="teyit-ters">FÄ°LTRELENDÄ°</span>');Â 
Â  Â  Â  Â  Â  Â  Â  Â  reason = reason.replace(/ONAYLANDI/g, '<span class="status-onay">ONAYLANDI</span>');Â 
Â  Â  Â  Â  Â  Â  Â  Â  return reason;Â 
Â  Â  Â  Â  Â  Â  } catch(e){ console.error("Reason Format Error:", e); return reason; }iOS
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Tablo GÃ¼ncelleme FonksiyonlarÄ± ---
Â  Â  Â  Â  function renderMainSignals() {
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  sortSignals(allSignals, mainSortState.key, mainSortState.direction);Â 
Â  Â  Â  Â  Â  Â  Â  Â  signalTableBody.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const filteredSignals = allSignals.filter(signal => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!signal || typeof signal.confidence === 'undefined') return false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const confidence = parseInt(signal.confidence);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const passesConfidence = confidence >= currentThreshold;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const strategyCode = signal.strategyType || 'ALL';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const passesStrategyFilter = activeStrategyFilter === 'ALL' || strategyCode === activeStrategyFilter;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return passesConfidence && passesStrategyFilter;Â 
Â  Â  Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (filteredSignals.length === 0) { signalTableBody.innerHTML = `<tr><td colspan="10" class="text-center text-muted py-3">Filtreye uygun sinyal yok veya hiÃ§ sinyal yok.</td></tr>`; return; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  filteredSignals.forEach(signal => { try { signalTableBody.appendChild(createMainSignalRow(signal)); } catch(e) { console.error("HATA: createMainSignalRow iÃ§inde:", e, signal); } });Â 
Â  Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: renderMainSignals iÃ§inde:", e); }
Â  Â  Â  Â  }
Â  Â  Â  Â  function renderMomentumSignals() {
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  momentumTableBody.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (momentumSignals.length === 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  momentumTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted py-3">HenÃ¼z momentum sinyali yok.</td></tr>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  const signalsToShow = momentumSignals.slice(0, MAX_MOMENTUM_SIGNALS);Â 
Â  Â  Â  Â  Â  Â  Â  Â  signalsToShow.forEach(signal => { try { momentumTableBody.appendChild(createMomentumSignalRow(signal)); } catch(e) { console.error("HATA: createMomentumSignalRow iÃ§inde:", e, signal); } });iOS
Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: renderMomentumSignals iÃ§inde:", e); }
Â  Â  Â  Â  }
Â  Â  Â  Â  function renderWatchlist() {
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const watchlistArray = Object.values(currentWatchlist);Â 
Â  Â  Â  Â  Â  Â  Â  Â  sortSignals(watchlistArray, wlSortState.key, wlSortState.direction);Â 
Â  Â  Â  Â  Â  Â  Â  Â  watchlistTableBody.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (watchlistArray.length === 0) { watchlistTableBody.innerHTML = `<tr><td colspan="10" class="text-center text-muted py-3">Liste boÅŸ.</td></tr>`; return; }
Â  Â  Â  Â  Â  Â  Â  Â  watchlistArray.forEach(item => { try { const row = createWatchlistRow(item); if(row) watchlistTableBody.appendChild(row); } catch(e) { console.error("HATA: createWatchlistRow iÃ§inde:", e, item); } });Â 
Â  Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: renderWatchlist iÃ§inde:", e); }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- SatÄ±r OluÅŸturma FonksiyonlarÄ± ---
Â  Â  Â  Â  function createMainSignalRow(signal) {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('tr');Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.id = 'signal-' + (signal.id || Math.random());Â 
Â  Â  Â  Â  Â  Â  Â  Â  const signalClass = signal.signal === 'LONG' ? 'bg-long' : (signal.signal === 'SHORT' ? 'bg-short' : (signal.isFiltered ? 'status-reddet' : 'bg-wait'));Â 
Â  Â  Â  Â  Â  Â  Â  Â  const tradingViewSymbol = (signal.symbol || '').replace('USDT', 'USDT.P'); // Binance Link
Â  Â  Â  Â  Â  Â  Â  Â  const strategyTag = getStrategyTag(signal.strategyType);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const bbWidth = signal.bbWidth ? `${signal.bbWidth}%` : '---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const confidence = signal.confidence ? `${signal.confidence}%` : '---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const volumeFormatted = getVolumeClassAndText(signal);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const formattedReason = formatReasonText(signal.tacticalAnalysis || signal.reason);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const rrValue = signal.RR && signal.RR !== 'N/A' && parseFloat(signal.RR) > 0 ? signal.RR : '---';

Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `<td>${formatTimestamp(signal.timestamp)}</td> <td class="symbol-cell"><a href="https://www.tradingview.com/chart/?symbol=BINANCE:${tradingViewSymbol}" target="_blank" class="link-text">${signal.symbol || 'N/A'}</a> ${strategyTag}</td> <td class="${signalClass}">${signal.signal || 'N/A'}</td> <td style="text-align: right;">${confidence}</td> <td style="text-align: right;">${signal.entryPrice || '---'}</td> <td>TP: ${signal.TP || '---'} / SL: ${signal.SL || '---'}</td> <td style="text-align: right;">${rrValue}</td> <td style="text-align: right;">${bbWidth}</td> <td>${volumeFormatted}</td> <td class="reason-cell">${formattedReason || '---'}</td>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  return row;Â 
Â  Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: createMainSignalRow:", e, signal); return document.createElement('tr'); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [V14.13 GÃœNCELLEMESÄ°]
Â  Â  Â  Â  function createMomentumSignalRow(signal) {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('tr');Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.id = 'momentum-' + (signal.id || Math.random());Â 
Â  Â  Â  Â  Â  Â  Â  Â  const signalClass = signal.signal === 'PUMP' ? 'bg-pump' : 'bg-dump';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const tradingViewSymbol = (signal.symbol || '').replace('USDT', 'USDT.P'); // Binance Link
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `<td>${formatTimestamp(signal.timestamp)}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td><a href="https://www.tradingview.com/chart/?symbol=BINANCE:${tradingViewSymbol}&interval=5" target="_blank" class="link-text">${signal.symbol || 'N/A'}</a></td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td class="${signalClass}">${signal.signal || 'N/A'}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td style="text-align: right;">${signal.entryPrice || '---'}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td>${signal.reason || '---'}</td>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  return row;Â 
Â  Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: createMomentumSignalRow:", e, signal); return document.createElement('tr'); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [V14.13 GÃœNCELLEMESÄ°]
Â  Â  Â  Â  function createWatchlistRow(item) {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('tr');Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.id = `wl-${item.symbol}`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  let signalClass = 'signal-wait';Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(item.signal === 'REDDEDÄ°LDÄ°' || item.isFiltered) signalClass = 'status-reddet';Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if (item.signal === 'LONG') signalClass = 'signal-long';Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if (item.signal === 'SHORT') signalClass = 'signal-short';Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if (item.signal === 'PUMP') signalClass = 'bg-pump'; 
Â  Â  Â  Â  Â  Â  Â  Â  else if (item.signal === 'DUMP') signalClass = 'bg-dump'; 
Â  Â  Â  Â  Â  Â  Â  Â  else if (item.signal === 'HATA' || item.signal === 'HATA/YOK') signalClass = 'bg-warning text-dark';Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const removeButton = `<button class="btn btn-danger btn-sm py-0 px-1" onclick="removeWatchlist('${item.symbol}')" title="KaldÄ±r">&times;</button>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const entryPrice = item.entryPrice || '---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const bbWidth = item.bbWidth ? `${item.bbWidth}%` : '---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const volumeFormatted = getVolumeClassAndText(item);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const formattedReason = formatReasonText(item.tacticalAnalysis || item.reason);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const stopLabel = item.SL ? `SL: ${item.SL}` : 'SL: ---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const confidenceText = item.confidence ? `${item.confidence}%` : '---';
Â  Â  Â  Â  Â  Â  Â  Â  const strategyTag = getStrategyTag(item.strategyType);
Â  Â  Â  Â  Â  Â  Â  Â  const tradingViewSymbol = (item.symbol || '').replace('USDT', 'USDT.P'); // Binance Link
Â  Â  Â  Â  Â  Â  Â  Â  const rrValue = item.RR && item.RR !== 'N/A' && parseFloat(item.RR) > 0 ? item.RR : '---';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `<td>${formatTimestamp(item.timestamp)}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td><a href="https://www.tradingview.com/chart/?symbol=BINANCE:${tradingViewSymbol}" target="_blank" class="link-text">${item.symbol || 'N/A'}</a> ${strategyTag}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td class="${signalClass}">${item.signal || 'Bekle'}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td style="text-align: right;">${entryPrice}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td>TP: ${item.TP || '---'} / ${stopLabel}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td style="text-align: right;">${rrValue}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td style="text-align: right;">${bbWidth}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td>${volumeFormatted}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td class="reason-cell">${formattedReason || '---'} | GÃ¼v: ${confidenceText}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <td>${removeButton}</td>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  return row;Â 
Â  Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: createWatchlistRow:", e, item); return null; }D
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Sinyal SÄ±ralama ---
Â  Â  Â  Â  function sortSignals(signalsArray, key, direction) { try { if(!signalsArray) return; signalsArray.sort((a, b) => { let aVal = a?.[key]; let bVal = b?.[key]; if (key === 'timestamp' || key === 'confidence' || key === 'RR' || key === 'bbWidth') { aVal = parseFloat(aVal) || (direction === 'asc' ? Infinity : -Infinity); bVal = parseFloat(bVal) || (direction === 'asc' ? Infinity : -Infinity); return direction === 'asc' ? aVal - bVal : bVal - aVal; } else { aVal = (aVal || '').toString().toLowerCase(); bVal = (bVal || '').toString().toLowerCase(); if (aVal < bVal) return direction === 'asc' ? -1 : 1; if (aVal > bVal) return direction === 'asc' ? 1 : -1; return 0; }}); } catch(e) { console.error("HATA: sortSignals:", e); } }

Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Olay Dinleyicileri (V14.13 UYUMLU) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [V14.13 GÃœNCELLEMESÄ°]
Â  Â  Â  Â  socket.on('initial_state', (state) => {
Â  Â  Â  Â  Â  Â  console.log('initial_state alÄ±ndÄ± (V14.13 Uyumlu)');
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const allSignalsData = state?.signals || [];
Â  Â  Â  Â  Â  Â  Â  Â  momentumSignals = allSignalsData.filter(s => s && s.strategyType === 'MOMENTUM5M');
Â  Â  Â  Â  Â  Â  Â  Â  allSignals = allSignalsData.filter(s => s && s.strategyType !== 'MOMENTUM5M');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  renderMainSignals();
Â  Â  Â  Â  Â  Â  Â  Â  renderMomentumSignals();
Â  Â  Â  Â  Â  Â  Â  Â  updateScanStatus(state?.scanStatus || { message: 'Durum bilgisi yok.', isScanning: false });
Â  Â  Â  Â  Â  Â  } catch(e){ console.error("HATA: initial_state:", e); }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [V14.13 GÃœNCELLEMESÄ°]
Â  Â  Â  Â  socket.on('yeni_sinyal', (sinyal) => {
Â  Â  Â  Â  Â  Â  console.log('yeni_sinyal alÄ±ndÄ± (V14.13 Uyumlu):', sinyal?.id);
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (!sinyal || !sinyal.id) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (sinyal.strategyType === 'MOMENTUM5M') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  momentumSignals.unshift(sinyal);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (momentumSignals.length > MAX_MOMENTUM_SIGNALS) momentumSignals.pop();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMomentumSignals();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allSignals.unshift(sinyal);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const row = createMainSignalRow(sinyal);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(row) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.classList.add('new-signal-row');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  signalTableBody.prepend(row);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch(e){ console.error("HATA: yeni_sinyal:", e); }
Â  Â  Â  Â  });

Â  Â  Â  Â  socket.on('watchlist_update', (watchlist) => {Â 
Â  Â  Â  Â  Â  Â  console.log('watchlist_update alÄ±ndÄ±');Â 
Â  Â  Â  Â  Â  Â  try { currentWatchlist = watchlist || {}; renderWatchlist(); }Â 
Â  Â  Â  Â  Â  Â  catch(e){ console.error("HATA: watchlist_update:", e); }iOS
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  socket.on('scan_status', (status) => {Â 
Â  Â  Â  Â  Â  Â  try { updateScanStatus(status); }Â 
Â  Â  Â  Â  Â  Â  catch(e){ console.error("HATA: scan_status:", e); }Â 
Â  Â  Â  Â  });

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {Â 
Â  Â  Â  Â  Â  Â  console.log("DOMContentLoaded");Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Ana Sinyal Tablosu SÄ±ralama
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.main-signal-table thead th[data-sort]').forEach(header => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  header.addEventListener('click', () => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const key = header.getAttribute('data-sort');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentDirection = mainSortState.key === key ? mainSortState.direction : 'desc';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.main-signal-table th .sort-icon').forEach(icon => icon.innerHTML = '');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iconSpan = header.querySelector('.sort-icon');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(iconSpan) iconSpan.innerHTML = newDirection === 'asc' ? 'â–²' : 'â–¼';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mainSortState = { key: key, direction: newDirection };Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMainSignals();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch(e){ console.error("HATA: Ana tablo sÄ±ralama click:", e); }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Watchlist SÄ±ralama
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.watchlist-table thead th[data-sort-wl]').forEach(header => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  header.addEventListener('click', () => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const key = header.getAttribute('data-sort-wl');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentDirection = wlSortState.key === key ? wlSortState.direction : 'desc';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wlSortState = { key: key, direction: newDirection };Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderWatchlist();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch(e){ console.error("HATA: Watchlist sÄ±ralama click:", e); }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Filtre butonlarÄ±
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.btn-filter').forEach(button => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', function() {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.btn-filter').forEach(btn => btn.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.classList.add('active');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  activeStrategyFilter = this.getAttribute('data-strategy'); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMainSignals();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch(e){ console.error("HATA: Strateji filtre click:", e); }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // GÃ¼ven Filtresi
Â  Â  Â  Â  Â  Â  Â  Â  applyFilterButton.addEventListener('click', () => { try { currentThreshold = parseInt(confidenceThresholdInput.value) || 0; renderMainSignals(); } catch(e){ console.error("HATA: GÃ¼ven filtre uygulama click:", e); } });
Â  Â  Â  Â  Â  Â  Â  Â  showAllButton.addEventListener('click', () => { try { currentThreshold = 0; confidenceThresholdInput.value = 0; renderMainSignals(); } catch(e){ console.error("HATA: TÃ¼mÃ¼nÃ¼ gÃ¶ster click:", e); } });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Manuel Analiz
Â  Â  Â  Â  Â  Â  Â  Â  analyzeButton.addEventListener('click', async () => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const symbol = symbolInput.value.trim().toUpperCase();iOS
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!symbol) return;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  analyzeButton.disabled = true; analyzeButton.textContent = 'Analiz...'; manualResultWrapper.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/analyze-coin', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ symbol }) });Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualResultDiv.innerHTML = renderManualResult(result);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualResultWrapper.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!result.error) symbolInput.value = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualResultDiv.innerHTML = `<div class="manual-result-title" style="color:#f44336;">HATA</div><div class="manual-result-text">API isteÄŸi baÅŸarÄ±sÄ±z: ${err.message}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualResultWrapper.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  S } finally {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  analyzeButton.disabled = false; analyzeButton.textContent = 'Analiz Et & Takip Et';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  manualCloseBtn.addEventListener('click', () => { manualResultWrapper.style.display = 'none'; });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // BaÅŸlangÄ±Ã§ render
Â  Â  Â  Â  Â  Â  Â  Â  renderMainSignals(); renderMomentumSignals(); renderWatchlist();
trÂ  Â  Â  } catch(e) { console.error("HATA: DOMContentLoaded iÃ§inde:", e); }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Manuel SonuÃ§ GÃ¶sterici
Â  Â  Â  Â  function renderManualResult(result) {Â 
Â  Â  Â  Â  Â  Â  Â try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!result || result.error) { return `<div class="manual-result-title" style="color:#f44336;">HATA</div><div class="manual-result-text">${result?.error || 'GeÃ§ersiz yanÄ±t.'}</div>`; }Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let signalClass = 'bg-wait';
Â  Â  Â  Â  Â  Â  Â  Â  if(result.signal === 'LONG') signalClass = 'bg-long';
Â  Â  Â  Â  Â  Â  Â  Â  else if (result.signal === 'SHORT') signalClass = 'bg-short';
Â  Â  Â  Â  Â  Â  Â  Â  else if (result.signal === 'PUMP') signalClass = 'bg-pump';
Â  Â  Â  Â  Â  Â  Â  Â  else if (result.signal === 'DUMP') signalClass = 'bg-dump';
Â  Â  Â  Â  Â  Â  Â  Â  else if (result.isFiltered || result.signal === 'REDDEDÄ°LDÄ°') signalClass = 'status-reddet';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const tradingViewSymbol = (result.symbol || '').replace('USDT', 'USDT.P'); // Binance Link
Â  Â  Â  Â  Â  Â  Â  Â  const priceLink = `<a href="https://www.tradingview.com/chart/?symbol=BINANCE:${tradingViewSymbol}" target="_blank" class="link-text" style="font-size:1.1em;">${result.symbol || 'N/A'}</a>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const bbWidth = result.bbWidth ? `BBW: ${result.bbWidth}%` : '---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const formattedReason = formatReasonText(result.tacticalAnalysis || result.reason);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const stopLabel = result.SL ? `SL: ${result.SL}` : 'SL: ---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const confidenceText = result.confidence ? `${result.confidence}%` : '---';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const volumeFormatted = getVolumeClassAndText(result);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const rrValue = result.RR && result.RR !== 'N/A' && parseFloat(result.RR) > 0 ? result.RR : '---';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  return `<div class="manual-result-title">Manuel Analiz (${formatTimestamp(result.timestamp)})</div> <div style="margin-bottom: 10px;">${priceLink} <span class="${signalClass} manual-signal-box">${result.signal || 'N/A'}</span></div> <div class="manual-result-text"> <p><strong>GiriÅŸ:</strong> ${result.entryPrice || '---'} | <strong>GÃ¼ven:</strong> ${confidenceText} | ${bbWidth}</p> <p><strong>TP/SL:</strong> TP: ${result.TP || '---'} / ${stopLabel} | <strong>R/R: ${rrValue}</strong></p> <p><strong>Hacim:</strong> ${volumeFormatted}</p> <p><strong>AÃ§Ä±klama:</strong> ${formattedReason || '---'}</p> </div>`;Â 
Â  Â  Â  Â  Â  Â  } catch(e) { console.error("HATA: renderManualResult iÃ§inde:", e, "Result:", result); return "SonuÃ§ gÃ¶sterilirken hata oluÅŸtu."; }S
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function removeWatchlist(symbol) {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/api/remove-watchlist', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ symbol }) });Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Hata: ${result.error || 'Bilinmeyen sunucu hatasÄ±'}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (err) { alert(`Sunucu hatasÄ±: ${err.message}`); }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  window.removeWatchlist = removeWatchlist; // Fonksiyonu global kapsama taÅŸÄ±

Â  Â  Â  Â  // Tarama durumunu gÃ¼ncelleme fonksiyonu
Â  Â  Â  Â  function updateScanStatus(status) {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const statusMsg = status?.message || 'Durum bilinmiyor.';i
Â  Â  Â  Â  Â  Â  Â  Â  if(scanStatusText) scanStatusText.textContent = statusMsg;Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(scanSpinner) scanSpinner.style.display = status?.isScanning ? 'inline-block' : 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(scanStatusText) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scanStatusText.classList.toggle('text-primary', status?.isScanning);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scanStatusText.classList.toggle('fw-bold', status?.isScanning);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch(e){ console.error("HATA: updateScanStatus iÃ§inde:", e); }Â 
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>